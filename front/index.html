<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Scraping</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .main {
      display: grid;
      grid-template-columns: 15% 40% 45%;
      height: 100dvh;
    }

    .lateral {
      background: #E1F56E;
      z-index: 10000;
      padding: 1rem;
    }

    .lateral ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      font-weight: bold;
    }

    .lists {
      margin-top: 1rem;
      font-size: .9rem;
    }

    .lists h3 {
      margin: .5rem 0;
    }

    .lists ul {
      list-style: none;
      padding-left: 1rem;
    }

    .lists li {
      margin-bottom: .35rem;
    }

    .right {
      height: 100dvh;
      overflow-y: auto;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      align-items: center;
      align-content: center;
      justify-items: center;
      padding: 1rem 0 2rem;
    }

    .resultados span {
      font-size: 2rem;
      font-weight: bold;
    }

    code {
      background: #E1F56E;
      color: #000;
      font-weight: bold;
      font-family: "Fira Code", monospace;
      padding: .2rem .5rem;
      border-radius: .4rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .card {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      height: 550px;
      width: 400px;
      background: #f7f7f7;
      padding: 1.5rem 1rem;
      border-radius: 2rem;
      border: 3px solid #dbdbdb;
      transition: transform .3s ease, box-shadow .3s ease;
    }

    .card img {
      width: 100%;
      max-height: 220px;
      object-fit: cover;
      border-radius: 1rem;
    }

    .text {
      display: flex;
      flex-direction: column;
      gap: .5rem;
    }

    .description {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .select {
      margin-top: auto;
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
    }

    .goto {
      display: inline-block;
      text-align: center;
      text-decoration: none;
      color: #000;
      background: #E1F56E;
      border: 2px solid #000;
      padding: 1rem 2rem;
      width: 60%;
      cursor: pointer;
      border-radius: 1rem;
      font-weight: 600;
      transition: background-color .3s ease, transform .2s ease;
    }

    .goto:hover {
      background: #dbdbdb;
      transform: scale(1.05);
    }

    .like,
    .dislike {
      height: 60px;
      width: 60px;
      border-radius: 2rem;
      padding: .5rem;
      border: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform .2s ease;
    }

    .like {
      background: green;
    }

    .dislike {
      background: red;
    }

    .like:hover,
    .dislike:hover {
      transform: scale(1.1);
    }

    /* Asegura color/tamaño del icono dentro del botón */
    .like svg,
    .dislike svg {
      width: 28px;
      height: 28px;
      fill: #fff;
    }

    /* Efecto tarjeta con :has */
    .card:has(.like:hover) {
      box-shadow: 0 7rem 20rem rgba(0, 128, 0, .4);
      transform: rotate(3deg) scale(1.02);
    }

    .card:has(.dislike:hover) {
      box-shadow: 0 7rem 20rem rgba(255, 0, 0, .4);
      transform: rotate(-3deg) scale(1.02);
    }

    .no-more {
      font-size: 1.5rem;
      font-weight: bold;
      color: #666;
      text-align: center;
      margin-top: 2rem;
    }

    .busquedas {
      display: flex;
      flex-direction: column;
      gap: 5rem;
      align-items: center;
    }

    .search {
      margin-top: 1rem;
      display: flex;
      align-items: center;
      gap: .5rem;
      background: #fff;
      border: 2px solid #e5e7eb;
      border-radius: 9999px;
      padding: .6rem 1rem;
      width: 80%;
      justify-self: center;
    }

    /* Evita el icono gigante */
    .search svg {
      width: 22px;
      height: 22px;
      flex-shrink: 0;
      fill: #6b7280;
    }

    .search textarea {
      border: none;
      outline: none;
      resize: none;
      width: 100%;
      font-size: .95rem;
      line-height: 1.4;
      color: #374151;
      background: transparent;
      font-family: inherit;
    }

    .description span {
      color: red;
    }
  </style>
</head>

<body>
  <section class="main">
    <section class="lateral">
      <!-- Listas guardados/descartados -->
      <div class="lists" id="guardadosBox">
        <h3>Guardados</h3>
        <ul id="guardadosList"></ul>
      </div>
      <div class="lists" id="descartadosBox">
        <h3>Descartados</h3>
        <ul id="descartadosList"></ul>
      </div>
    </section>

    <section class="right">
      <div class="busquedas">
        <div class="search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              d="M19.31 18.9C19.75 18.21 20 17.38 20 16.5C20 14 18 12 15.5 12S11 14 11 16.5 13 21 15.5 21C16.37 21 17.19 20.75 17.88 20.32L21 23.39L22.39 22L19.31 18.9M15.5 19C14.12 19 13 17.88 13 16.5S14.12 14 15.5 14 18 15.12 18 16.5 16.88 19 15.5 19M5 20V12H2L12 3L22 12H20.18C19.33 11.11 18.23 10.47 17 10.18L12 5.69L7 10.19V18H9.18C9.35 18.72 9.64 19.39 10.03 20H5Z" />
          </svg>
          <textarea placeholder="Buscar casa con URL idealista" rows="1"></textarea>
        </div>


        <div class="cards">
          <div class="resultados">
            <span>Resultados: <code id="numResultados">0</code></span>
          </div>
          <div id="cardsContainer"></div>
        </div>
      </div>
    </section>

    <style>
      .site {
        height: 100dvh;
        background-color: #E1F56E;
      }
    </style>
    <section class="site"></section>
  </section>

  <script>
    let index = 0;
    let data = [];
    const guardados = [];
    const descartados = [];

    async function cargarJSON() {
      try {
        const r = await fetch("data.json");   // JSON externo en la misma carpeta
        data = await r.json();
        document.getElementById("numResultados").textContent = data.length;
        renderCard(index);
      } catch (e) {
        document.getElementById("cardsContainer").innerHTML = "<p style='color:red'>Error cargando JSON</p>";
        console.error(e);
      }
    }

    function renderCard(i) {
      const container = document.getElementById("cardsContainer");
      if (i >= data.length) {
        container.innerHTML = `<div class="no-more">No hay más inmuebles</div>`;
        return;
      }

      const item = data[i];
      container.innerHTML = `
        <div class="card">
          <img src="${item.image}" alt="${item.detalles?.tipo || 'Inmueble'}" />
          <div class="text">
            <h2>${item.detalles?.tipo || ''} en ${item.ubicacion || ''}</h2>
            <div class="description">
              <p>${item.detalles?.habitaciones ?? '-'} hab.</p>
              <p>${item.detalles?.metros_cuadrados ?? '-'} m²</p>
              ${item.detalles?.planta ? `<p>${item.detalles.planta}</p>` : ""}
              <span>${item.precio || ''}</span>
            </div>
            <div class="select">
              <button class="like" title="Guardar">
                <!-- SVG LIKE COMPLETO -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z"/>
                </svg>
              </button>

              <a href="${item.url}" target="_blank" class="goto">Visitar sitio</a>

              <button class="dislike" title="Descartar">
                <!-- SVG DISLIKE COMPLETO -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M19,15H23V3H19M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14A2,2 0 0,0 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.77 8.33,20.88C8.33,21.3 8.5,21.67 8.77,21.94L9.83,23L16.41,16.41C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      `;

      container.querySelector(".like").addEventListener("click", () => {
        guardados.push(item);
        pintarLista("guardadosList", guardados);
        index++; renderCard(index);
      });

      container.querySelector(".dislike").addEventListener("click", () => {
        descartados.push(item);
        pintarLista("descartadosList", descartados);
        index++; renderCard(index);
      });
    }

    function pintarLista(listId, arr) {
      const ul = document.getElementById(listId);
      ul.innerHTML = "";
      arr.forEach(it => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${it.url}" target="_blank">${it.detalles?.tipo || 'Inmueble'} — ${it.precio || ''}</a>`;
        ul.appendChild(li);
      });
    }

    cargarJSON();
  </script>
</body>

</html>